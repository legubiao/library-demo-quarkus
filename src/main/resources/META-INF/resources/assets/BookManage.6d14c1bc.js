var fe=Object.defineProperty,ve=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var R=(e,l,t)=>l in e?fe(e,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[l]=t,_=(e,l)=>{for(var t in l||(l={}))be.call(l,t)&&R(e,t,l[t]);if($)for(var t of $(l))ge.call(l,t)&&R(e,t,l[t]);return e},B=(e,l)=>ve(e,pe(l));import{r as ke,u as V,Q as Z,w as he}from"./xlsx.43a940b6.js";import{h as c,c as J,aw as ye,ax as Ce,_ as U,Q as v,R as y,S as r,T as _e,U as we,aE as Se,aL as xe,be as Fe,aF as Be,bf as Ve,aH as Qe,r as p,aM as Ne,bg as qe,bh as Te,a as b,aN as X,bi as Ae,aG as De,g as Ie,al as je,w as Ee,a2 as Q,W as n,ar as j,X as G,Y as S,bj as Pe,a6 as E,a3 as h,Z as K,$ as P,a7 as ee,B as Y,aq as H,a4 as N,a5 as Ue,at as Me,aD as Le,a0 as Oe,i as ze,K as W,bk as $e}from"./index.bc8510fa.js";import{a as Re,Q as Xe,B as Ge,b as Ke}from"./BookDialog.5092da2e.js";import{a as Ye,Q as le}from"./use-cache.df12cf91.js";import{u as He}from"./use-quasar.28424290.js";import{Q as We}from"./QInnerLoading.b919ddb6.js";import"./QList.050f4af1.js";import"./selection.4f5ad97a.js";import"./QResizeObserver.d171c610.js";const Ze=[c("g",{transform:"translate(20 50)"},[c("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.6"},[c("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),c("g",{transform:"translate(50 50)"},[c("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.8"},[c("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.1s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])]),c("g",{transform:"translate(80 50)"},[c("rect",{x:"-10",y:"-30",width:" 20",height:"60",fill:"currentColor",opacity:"0.9"},[c("animateTransform",{attributeName:"transform",type:"scale",from:"2",to:"1",begin:"0.2s",repeatCount:"indefinite",dur:"1s",calcMode:"spline",keySplines:"0.1 0.9 0.4 1",keyTimes:"0;1",values:"2;1"})])])];var Je=J({name:"QSpinnerFacebook",props:ye,setup(e){const{cSize:l,classes:t}=Ce(e);return()=>c("svg",{class:t.value,width:l.value,height:l.value,viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",preserveAspectRatio:"xMidYMid"},Ze)}});const el={name:"TransitionFlip"};function ll(e,l,t,a,m,s){return v(),y(we,{mode:"out-in","enter-active-class":"animated flipInX","leave-active-class":"animated flipOutX"},{default:r(()=>[_e(e.$slots,"default")]),_:3})}var ae=U(el,[["render",ll]]),al=J({name:"QFile",inheritAttrs:!1,props:B(_(_(_({},Se),xe),Fe),{modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]}),emits:[...Be,...Ve],setup(e,{slots:l,emit:t,attrs:a}){const{proxy:m}=Ie(),s=Qe(),d=p(null),i=p(!1),C=Ne(e),{pickFiles:g,onDragover:w,onDragleave:q,processFiles:T,getDndNode:x}=qe({editable:s.editable,dnd:i,getFileInput:ue,addFilesToQueue:z}),A=Te(e),u=b(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),M=b(()=>X(u.value)),te=b(()=>u.value.map(o=>o.name).join(", ")),L=b(()=>Ae(u.value.reduce((o,f)=>o+f.size,0))),oe=b(()=>({totalSize:L.value,filesNumber:u.value.length,maxFiles:e.maxFiles})),ne=b(()=>B(_({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:C.value},a),{id:s.targetUid.value,disabled:s.editable.value!==!0})),O=b(()=>e.multiple===!0&&e.append===!0);function D(o){const f=u.value.slice();f.splice(o,1),I(f)}function ie(o){const f=u.value.findIndex(o);f>-1&&D(f)}function I(o){t("update:modelValue",e.multiple===!0?o:o[0])}function se(o){o.keyCode===13&&je(o)}function re(o){(o.keyCode===13||o.keyCode===32)&&g(o)}function ue(){return d.value}function z(o,f){const k=T(o,f,u.value,O.value);k!==void 0&&((e.multiple===!0?e.modelValue&&k.every(me=>u.value.includes(me)):e.modelValue===k[0])||I(O.value===!0?u.value.concat(k):k))}function F(){return[c("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function ce(){if(l.file!==void 0)return u.value.length===0?F():u.value.map((f,k)=>l.file({index:k,file:f,ref:this}));if(l.selected!==void 0)return u.value.length===0?F():l.selected({files:u.value,ref:this});if(e.useChips===!0)return u.value.length===0?F():u.value.map((f,k)=>c(Ye,{key:"file-"+k,removable:s.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{D(k)}},()=>c("span",{class:"ellipsis",textContent:f.name})));const o=e.displayValue!==void 0?e.displayValue:te.value;return o.length>0?[c("div",{class:e.inputClass,style:e.inputStyle,textContent:o})]:F()}function de(){const o=B(_(_({ref:d},ne.value),A.value),{class:"q-field__input fit absolute-full cursor-pointer",onChange:z});return e.multiple===!0&&(o.multiple=!0),c("input",o)}return Object.assign(s,{fieldClass:{value:"q-file q-field--auto-height"},emitValue:I,hasValue:M,inputRef:d,innerValue:u,floatingLabel:b(()=>M.value===!0||X(e.displayValue)),computedCounter:b(()=>{if(e.counterLabel!==void 0)return e.counterLabel(oe.value);const o=e.maxFiles;return`${u.value.length}${o!==void 0?" / "+o:""} (${L.value})`}),getControlChild:()=>x("file"),getControl:()=>{const o={ref:s.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return s.editable.value===!0&&Object.assign(o,{onDragover:w,onDragleave:q,onKeydown:se,onKeyup:re}),c("div",o,[de()].concat(ce()))}}),Object.assign(m,{removeAtIndex:D,removeFile:ie,getNativeElement:()=>d.value}),De(s)}});const tl=[{name:"id",label:"\u6761\u7801\u53F7",align:"left",field:"id"},{name:"title",label:"\u6807\u9898",align:"left",field:"title",sortable:!0},{name:"author",label:"\u4F5C\u8005",align:"left",field:"author",sortable:!0},{name:"publisher",label:"\u51FA\u7248\u793E",align:"left",field:"publisher",sortable:!0},{name:"callNumber",label:"\u7D22\u4E66\u53F7",align:"left",field:"callNumber",sortable:!0},{name:"isbn",label:"ISBN",align:"left",field:"isbn",sortable:!0}],ol={name:"BookUploader",components:{TransitionFlip:ae},setup(e,l){const t=p(!1),a=p(!1),m=p([]),s=p([]),d=p(null);Ee(d,g=>{if(g!==null){const w=new FileReader;w.onload=function(q){a.value=!0;const T=q.target.result,x=ke(T,{type:"binary"}),A=x.Sheets[x.SheetNames[0]];V.sheet_to_json(A).forEach(u=>{m.value.push(u)}),a.value=!1},w.readAsBinaryString(g)}});function i(){d.value=null,m.value=[],s.value=[]}function C(){i(),t.value=!0}return{columns:tl,visible:t,loading:a,books:m,selected:s,excel:d,clear:i,loadAll(){l.emit("load",m.value),t.value=!1,m.value=[],s.value=[]},loadSelected(){l.emit("load",s.value),t.value=!1,m.value=[],s.value=[]},show:C}}},nl=N("div",{class:"text-h6"},"\u56FE\u4E66\u4E0A\u4F20",-1);function il(e,l,t,a,m,s){const d=Q("transition-flip");return v(),y(Le,{modelValue:a.visible,"onUpdate:modelValue":l[3]||(l[3]=i=>a.visible=i)},{default:r(()=>[n(Me,{style:{"min-width":"22rem","max-width":"80vw"},class:"q-pa-sm"},{default:r(()=>[n(j,{class:"q-pa-sm row items-center"},{default:r(()=>[n(al,{outlined:"",modelValue:a.excel,"onUpdate:modelValue":l[1]||(l[1]=i=>a.excel=i),label:"\u4E0A\u4F20\u56FE\u4E66Excel\u8868"},{before:r(()=>[nl]),append:r(()=>[a.excel!==null?(v(),y(G,{key:0,name:"close",onClick:a.clear,class:"cursor-pointer"},null,8,["onClick"])):S("",!0),n(G,{name:"create_new_folder",onClick:l[0]||(l[0]=Pe(()=>{},["stop"]))})]),_:1},8,["modelValue"]),a.books.length!==0&&e.$q.screen.gt.xs?(v(),E(ee,{key:0},[n(Z),n(d,{class:"text-subtitle1"},{default:r(()=>[a.selected.length!==0?(v(),y(h,{key:0,color:"primary",outline:"",onClick:a.loadSelected},{default:r(()=>[K(" \u5F55\u5165\u9009\u4E2D\u7684"+P(a.selected.length)+"\u672C\u4E66 ",1)]),_:1},8,["onClick"])):(v(),y(h,{key:1,color:"primary",onClick:a.loadAll,label:"\u5168\u90E8\u5F55\u5165"},null,8,["onClick"]))]),_:1})],64)):S("",!0)]),_:1}),n(Re,null,{default:r(()=>[Y(N("div",null,[n(Ue,{class:"q-ma-sm"}),n(j,{class:"q-pa-sm"},{default:r(()=>[n(le,{rows:a.books,columns:a.columns,pagination:{rowsPerPage:7},selection:"multiple",selected:a.selected,"onUpdate:selected":l[2]||(l[2]=i=>a.selected=i),"row-key":"bookID"},null,8,["rows","columns","selected"]),n(We,{showing:a.loading},{default:r(()=>[n(Xe,{size:"50px",color:"primary"})]),_:1},8,["showing"])]),_:1}),e.$q.screen.lt.sm?(v(),y(j,{key:0,class:"row q-pa-sm justify-end q-gutter-x-md text-subtitle1"},{default:r(()=>[n(d,null,{default:r(()=>[Y(n(h,{color:"primary",outline:"",onClick:a.loadSelected},{default:r(()=>[K(" \u5F55\u5165\u9009\u4E2D\u7684"+P(a.selected.length)+"\u672C\u4E66 ",1)]),_:1},8,["onClick"]),[[H,a.selected.length!==0]])]),_:1}),n(h,{color:"primary",onClick:a.loadAll,label:"\u5168\u90E8\u5F55\u5165"},null,8,["onClick"])]),_:1})):S("",!0)],512),[[H,a.books.length!==0]])]),_:1})]),_:1})]),_:1},8,["modelValue"])}var sl=U(ol,[["render",il]]);const rl=[{name:"id",label:"\u6761\u7801\u53F7",align:"left",field:"id"},{name:"title",label:"\u6807\u9898",align:"left",field:"title",sortable:!0},{name:"author",label:"\u4F5C\u8005",align:"left",field:"author",sortable:!0},{name:"publisher",label:"\u51FA\u7248\u793E",align:"left",field:"publisher",sortable:!0},{name:"callNumber",label:"\u7D22\u4E66\u53F7",align:"left",field:"callNumber",sortable:!0},{name:"isbn",label:"ISBN",align:"left",field:"isbn",sortable:!0}],ul=Oe({name:"BookManage",components:{BookDialog:Ge,BookUploader:sl,TransitionFlip:ae},setup(){const e=He(),l=ze("api").value,t=p([]),a=p([]),m=p(!1);W("selectedBook",a),W("addBookVisible",m);function s(){t.value=[],a.value=[]}function d(){a.value.length!==t.value.length?(a.value.forEach(i=>{t.value.splice(t.value.indexOf(i),1)}),a.value=[]):s()}return{columns:rl,bookData:t,selected:a,hasBook:b(()=>t.value.length!==0),hasSelected:b(()=>a.value.length!==0),addBookVisible:m,bookDialog:p(),bookUploader:p(),removeBook:d,clearBook:s,exportExcel(){e.loading.show({spinner:Je,spinnerSize:200,message:"\u6B63\u5728\u751F\u6210\u56FE\u4E66\u4FE1\u606F\u8868\uFF0C\u8BF7\u7A0D\u540E..."});const i=V.json_to_sheet(t.value),C=V.book_new();V.book_append_sheet(C,i,"book"),e.loading.hide(),he(C,"\u56FE\u4E66\u4FE1\u606F.xlsx")},load(i){t.value=i},updateAll(){l.post("book/list",a.value.length===0?t.value:a.value).then(i=>{e.notify({message:"\u5DF2\u6210\u529F\u66F4\u65B0"+i.data+"\u6761\u56FE\u4E66\u4FE1\u606F",type:"positive"})})},createCopy(){l.post("copy/list",a.value.length===0?t.value:a.value).then(i=>{e.notify({message:"\u5DF2\u6210\u529F\u521B\u5EFA"+i.data+"\u6761\u56FE\u4E66\u526F\u672C",type:"positive"})})}}}}),cl={class:"q-pa-md"},dl={class:"q-gutter-x-md row"},ml=["onClick"];function fl(e,l,t,a,m,s){const d=Q("book-uploader"),i=Q("transition-flip"),C=Q("book-dialog");return v(),E("div",cl,[n(le,{rows:e.bookData,columns:e.columns,title:"\u56FE\u4E66\u57FA\u672C\u4FE1\u606F\u7BA1\u7406","title-class":"text-bold",class:"sticky-header-table full-height","row-key":"tid",selection:"multiple",selected:e.selected,"onUpdate:selected":l[1]||(l[1]=g=>e.selected=g),pagination:{rowsPerPage:15}},{"top-right":r(()=>[n(d,{ref:"bookUploader",onLoad:e.load},null,8,["onLoad"]),n(Z),N("div",dl,[n(i,null,{default:r(()=>[e.hasSelected&&e.hasBook?(v(),y(h,{key:0,flat:"",icon:"remove",color:"negative",round:"",onClick:e.removeBook},null,8,["onClick"])):S("",!0)]),_:1}),n($e,{mode:"out-in","enter-active-class":"animated flipInX","leave-active-class":"animated flipOutX"},{default:r(()=>[e.hasBook?(v(),E(ee,{key:0},[n(h,{flat:"",icon:"clear",round:"",onClick:e.clearBook},null,8,["onClick"]),n(h,{icon:"move_up",color:"secondary",label:"\u521B\u5EFA\u56FE\u4E66\u526F\u672C",onClick:e.createCopy},null,8,["onClick"]),n(h,{icon:"sync",color:"secondary",label:"\u66F4\u65B0\u56FE\u4E66\u6570\u636E",onClick:e.updateAll},null,8,["onClick"])],64)):S("",!0)]),_:1}),n(i,null,{default:r(()=>[e.hasBook?(v(),y(h,{key:0,icon:"archive",color:"primary",label:"\u4E0B\u8F7DExcel",onClick:e.exportExcel},null,8,["onClick"])):(v(),y(h,{key:1,outline:"",padding:"sm",icon:"unarchive",color:"primary",label:"\u4E0A\u4F20Excel",onClick:l[0]||(l[0]=g=>e.bookUploader.show())}))]),_:1})])]),"body-cell-title":r(g=>[n(Ke,{class:"bookTitle"},{default:r(()=>[N("b",{onClick:w=>e.bookDialog.show(g.row)},P(g.value),9,ml)]),_:2},1024)]),_:1},8,["rows","columns","selected"]),n(C,{ref:"bookDialog"},null,512)])}var Sl=U(ul,[["render",fl],["__scopeId","data-v-5691bde3"]]);export{Sl as default};
